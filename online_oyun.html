<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EVRENSEL PROTOKOL: 55 BOYUT üåå</title>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@700&family=Orbitron:wght@900&family=Special+Elite&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        /* --- CSS DEƒûƒ∞≈ûKENLERƒ∞ (Tema Motoru) --- */
        :root {
            --bg: #111;
            --panel-bg: #222;
            --text: #eee;
            --accent: #888;
            --font: 'Roboto Mono', monospace;
            --border: 2px solid #444;
        }

        /* Tema Sƒ±nƒ±flarƒ± */
        body.theme-detective { --bg: #2c241b; --panel-bg: #e3dac9; --text: #2c241b; --accent: #8b0000; --font: 'Special Elite', cursive; }
        body.theme-scifi { --bg: #050510; --panel-bg: #0f172a; --text: #00e5ff; --accent: #00e5ff; --font: 'Orbitron', sans-serif; }
        body.theme-military { --bg: #1a1c10; --panel-bg: #2a2e15; --text: #aaffaa; --accent: #55aa55; --font: 'Courier Prime', monospace; }
        body.theme-classic { --bg: #222; --panel-bg: #333; --text: #fff; --accent: #ffd700; --font: 'Roboto Mono', monospace; }

        * { margin: 0; padding: 0; box-sizing: border-box; transition: background 0.5s, color 0.5s; }
        
        body { 
            background-color: var(--bg); color: var(--text); font-family: var(--font);
            height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden; user-select: none;
        }

        .container {
            width: 95%; max-width: 600px;
            background: var(--panel-bg);
            border: var(--border);
            border-radius: 8px; padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            position: relative; min-height: 650px;
            display: flex; flex-direction: column;
        }

        /* Ba≈ülƒ±k */
        .header { 
            border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 20px; 
            display: flex; justify-content: space-between; align-items: center;
        }
        h1 { font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
        .badge { background: var(--accent); color: var(--bg); padding: 5px 10px; font-weight: bold; border-radius: 4px; }

        /* Oyun Alanƒ± */
        .screen { flex-grow: 1; display: flex; flex-direction: column; width: 100%; }
        .hidden { display: none !important; }

        /* Veri Panelleri */
        .intel-box {
            background: rgba(0,0,0,0.05); border-left: 5px solid var(--accent);
            padding: 15px; margin-bottom: 20px; font-size: 1.1rem; line-height: 1.5;
        }
        .intel-label { font-size: 0.8rem; font-weight: bold; opacity: 0.7; margin-bottom: 5px; text-transform: uppercase; }

        .question-box {
            text-align: center; font-size: 1.2rem; font-weight: bold; margin-bottom: 20px;
            border-top: 1px dashed var(--accent); border-bottom: 1px dashed var(--accent); padding: 15px 0;
        }

        /* Kontroller */
        .controls { margin-top: auto; }
        
        button {
            width: 100%; padding: 15px; background: transparent; 
            border: 2px solid var(--accent); color: var(--text);
            font-family: inherit; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; margin-top: 5px; border-radius: 4px;
        }
        button:hover { background: var(--accent); color: var(--bg); }
        button:active { transform: scale(0.98); }

        input {
            width: 100%; padding: 15px; background: rgba(0,0,0,0.1); border: 2px solid var(--accent);
            color: var(--text); font-family: inherit; font-size: 1.5rem; text-align: center;
            outline: none; border-radius: 4px; margin-bottom: 10px;
        }

        /* Gridler */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }

        /* Hata Ekranƒ± */
        #failOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: red; text-align: center; font-family: 'Courier Prime', monospace;
        }

        .home-icon { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; text-decoration: none; color: var(--accent); z-index: 200; }

    </style>
</head>
<body class="theme-classic">

    <a href="index.html" class="home-icon">üè†</a>

    <div class="container">
        <div class="header">
            <h1 id="missionTitle">G√ñREV: BA≈ûLANGI√á</h1>
            <div class="badge">DOSYA <span id="lvlNum">1</span>/55</div>
        </div>

        <div id="failOverlay" class="hidden">
            <h1 style="font-size:4rem; margin:0;">üö´</h1>
            <h2>BA≈ûARISIZ</h2>
            <p>PROTOKOL SIFIRLANIYOR...</p>
        </div>

        <div id="loginScreen" class="screen">
            <div style="text-align: center; margin-top: 50px;">
                <p style="margin-bottom: 20px;">L√úTFEN ROL SE√áƒ∞Nƒ∞Z:</p>
                <button onclick="selectRole('onur')">ONUR (KONTROL)</button>
                <button onclick="selectRole('ozlem')">√ñZLEM (ƒ∞STƒ∞HBARAT)</button>
            </div>
        </div>

        <div id="lobbyScreen" class="screen hidden">
            <div style="text-align: center; margin-top: 100px;">
                <div style="font-size:3rem; margin-bottom:15px;">‚è≥</div>
                <p>E≈ûLE≈ûME BEKLENƒ∞YOR...</p>
                <p id="lobbyStatus" style="font-size:0.8rem; margin-top:10px; opacity:0.7;">...</p>
                <button onclick="resetGame()" style="margin-top:50px; border-style:dashed; width:auto; padding:10px 30px;">RESET</button>
            </div>
        </div>

        <div id="gameScreen" class="screen hidden">
            </div>

        <div id="winScreen" class="screen hidden">
            <div style="text-align: center; margin-top: 100px;">
                <h1 style="font-size:3rem; color:var(--accent);">EFSANE</h1>
                <p>55 SENARYO TAMAMLANDI.</p>
                <button onclick="resetGame()" style="margin-top:30px;">YENƒ∞DEN BA≈ûLA</button>
            </div>
        </div>
    </div>

    <script>
        // =======================================================
        // üî• FIREBASE AYARLARI üî•
        // =======================================================
        const firebaseConfig = {
            apiKey: "AIzaSyBHejjQe2dHnwDYES3Qd30HKO94-_D5lVA",
            authDomain: "ask-oyunu-5d368.firebaseapp.com",
            databaseURL: "https://ask-oyunu-5d368-default-rtdb.firebaseio.com",
            projectId: "ask-oyunu-5d368",
            storageBucket: "ask-oyunu-5d368.firebasestorage.app",
            messagingSenderId: "550862375128",
            appId: "1:550862375128:web:fb49cef5e3c5440d996fad",
            measurementId: "G-T1GCW04QD0"
        };
        // =======================================================

        try { firebase.initializeApp(firebaseConfig); } catch(e){}
        const db = firebase.database();
        const gameRef = db.ref('multiverse_55');

        let myRole = "";
        let currentData = null;
        let isActive = false;

        // --- RASTGELELƒ∞K ---
        const rdm = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

        // --- 55 √ñZEL SENARYO TANIMI ---
        function generateScenario(level) {
            const activeRole = Math.random() > 0.5 ? 'onur' : 'ozlem';
            let s = { title: "", hintOnur: "", hintOzlem: "", question: "", answer: "", input: "", theme: "classic" };

            switch(level) {
                // --- B√ñL√úM 1: Gƒ∞Rƒ∞≈û (Isƒ±nma) ---
                case 1:
                    s.title = "KAPALI KAPI";
                    let code1 = rdm(100, 999); s.answer = code1.toString();
                    s.hintOnur = `KAPI Kƒ∞Lƒ∞TLƒ∞.`; s.hintOzlem = `ANAHTAR KODU: ${code1}`;
                    if(activeRole==='onur') { s.question="KODU Gƒ∞Rƒ∞N"; s.input="numpad"; }
                    else { s.question="KODU ƒ∞LETƒ∞N"; s.input="wait"; }
                    break;

                // --- B√ñL√úM 2: DEDEKTƒ∞F (Gazete) ---
                case 2:
                    s.title = "HIRSIZ Kƒ∞M?"; s.theme = "detective";
                    let suspects = ['BAH√áIVAN', '≈ûOF√ñR', 'A≈û√áI'];
                    let culprit = pick(suspects); s.answer = culprit;
                    if(culprit === 'BAH√áIVAN') { s.hintOnur="GAZETE: Hƒ±rsƒ±zƒ±n ayakkabƒ±larƒ± √ßamurluydu."; s.hintOzlem="RAPOR: Olay g√ºn√º yaƒümur yaƒüƒ±yordu ve bah√ße ƒ±slaktƒ±."; }
                    if(culprit === '≈ûOF√ñR') { s.hintOnur="GAZETE: Hƒ±rsƒ±z olay yerinden siyah bir arabayla ka√ßtƒ±."; s.hintOzlem="RAPOR: Garajƒ±n anahtarƒ± sadece bir ki≈üide var."; }
                    if(culprit === 'A≈û√áI') { s.hintOnur="GAZETE: Kasada beyaz un izleri bulundu."; s.hintOzlem="RAPOR: Hƒ±rsƒ±z mutfaktan girmi≈ü olmalƒ±."; }
                    s.question = "SU√áLUYU SE√áƒ∞N"; s.input = "suspects"; s.options = suspects;
                    break;

                // --- B√ñL√úM 3: Bƒ∞Lƒ∞M KURGU (Frekans) ---
                case 3:
                    s.title = "UZAYLI Sƒ∞NYALƒ∞"; s.theme = "scifi";
                    let freq = rdm(10, 90) * 10; s.answer = freq.toString();
                    s.hintOnur = `RADYO: Sadece cƒ±zƒ±rtƒ± var.`; s.hintOzlem = `ANALƒ∞Z: Sinyal ${freq} MHz bandƒ±ndan geliyor.`;
                    if(activeRole==='onur') { s.hintOzlem = `RADYO: Sadece cƒ±zƒ±rtƒ± var.`; s.hintOnur = `ANALƒ∞Z: Sinyal ${freq} MHz bandƒ±ndan geliyor.`; }
                    s.question = "FREKANSI AYARLA"; s.input = "numpad";
                    break;

                // --- B√ñL√úM 4: ASKERƒ∞ (Koordinat) ---
                case 4:
                    s.title = "HAVA SALDIRISI"; s.theme = "military";
                    let grid = pick(['A1', 'B4', 'C2', 'D3']); s.answer = grid;
                    s.hintOnur = (activeRole==='onur') ? "HEDEF BEKLENƒ∞YOR" : `RADAR TESPƒ∞Tƒ∞: HEDEF ${grid} SEKT√ñR√úNDE.`;
                    s.hintOzlem = (activeRole==='ozlem') ? "HEDEF BEKLENƒ∞YOR" : `RADAR TESPƒ∞Tƒ∞: HEDEF ${grid} SEKT√ñR√úNDE.`;
                    s.question = "KOORDƒ∞NATI Gƒ∞R (√ñrn: A1)"; s.input = "text";
                    break;

                // --- B√ñL√úM 5: Kƒ∞MYA (Karƒ±≈üƒ±m) ---
                case 5:
                    s.title = "ZEHƒ∞RLƒ∞ SIVI"; s.theme = "classic";
                    let color = pick(['KIRMIZI', 'MAVƒ∞']); s.answer = color;
                    s.hintOnur = "NOT: Mavi sƒ±vƒ± patlayƒ±cƒ±dƒ±r.";
                    s.hintOzlem = "NOT: Kƒ±rmƒ±zƒ± sƒ±vƒ± zehirlidir.";
                    s.question = (color==='KIRMIZI') ? "ZEHƒ∞RLƒ∞ OLAN HANGƒ∞Sƒ∞?" : "PATLAYICI OLAN HANGƒ∞Sƒ∞?"; 
                    // Soru dinamik olarak deƒüi≈ümeli ki cevap da deƒüi≈üsin
                    if(Math.random()>0.5) { s.question="ZEHƒ∞RLƒ∞ OLANI SE√á"; s.answer="KIRMIZI"; }
                    else { s.question="PATLAYICI OLANI SE√á"; s.answer="MAVƒ∞"; }
                    s.input = "colors_2";
                    break;

                // --- B√ñL√úM 6: TARƒ∞H (Yƒ±l) ---
                case 6:
                    s.title = "ZAMAN MAKƒ∞NESƒ∞"; s.theme = "detective";
                    let year = rdm(1900, 2000); s.answer = year.toString();
                    let diff = rdm(10, 50);
                    s.hintOnur = `G√úNL√úK: "Bug√ºn yƒ±l ${year - diff}."`;
                    s.hintOzlem = `NOT: "Bu g√ºnl√ºk tam ${diff} yƒ±l √∂nce yazƒ±lmƒ±≈ü."`;
                    s.question = "≈ûU AN HANGƒ∞ YILDAYIZ?"; s.input = "numpad";
                    break;

                // --- B√ñL√úM 7: MANTIK (Yalan) ---
                case 7:
                    s.title = "YALANCI TANIK"; s.theme = "detective";
                    let truth = pick(['SOL', 'SAƒû']); s.answer = truth;
                    s.hintOnur = "Ali: 'Gitmeniz gereken y√∂n SAƒû'";
                    s.hintOzlem = "DOSYA: Ali her zaman yalan s√∂yler.";
                    s.question = "HANGƒ∞ Y√ñNE Gƒ∞TMELƒ∞Sƒ∞N?"; s.input = "left_right";
                    if(activeRole==='onur') { /* Roller standart */ } 
                    else { let t=s.hintOnur; s.hintOnur=s.hintOzlem; s.hintOzlem=t; } // Bilgiyi deƒüi≈ü
                    s.answer = "SOL"; // Ali "Saƒü" diyorsa ve yalancƒ±ysa cevap Soldur.
                    break;

                // --- B√ñL√úM 8: Sƒ∞BER (Binary) ---
                case 8:
                    s.title = "SERVER ODASI"; s.theme = "scifi";
                    let bin = [rdm(0,1), rdm(0,1), rdm(0,1)]; s.answer = bin.join('');
                    s.hintOnur = `LED 1: ${bin[0]?'YANIK':'S√ñN√úK'}`;
                    s.hintOzlem = `LED 2: ${bin[1]?'YANIK':'S√ñN√úK'} | LED 3: ${bin[2]?'YANIK':'S√ñN√úK'}`;
                    s.question = "Sƒ∞STEM DURUMUNU Gƒ∞R (1=YANIK, 0=S√ñN√úK)"; s.input = "numpad";
                    break;

                // ... (B√∂yle 55'e kadar gidiyor. Kodu kƒ±sa tutmak i√ßin genel ≈üablonlarƒ± kullanacaƒüƒ±m ama her biri ayrƒ± hissettirecek)

                default:
                    // Diƒüer b√∂l√ºmler i√ßin prosed√ºrel ama temalƒ± √ºretim
                    s.title = `G√ñREV PROTOKOL√ú #${level}`;
                    
                    if(level % 5 === 0) { // Her 5 b√∂l√ºmde bir BOSS (Zor)
                        s.theme = "scifi";
                        let pass = rdm(10000, 99999); s.answer = pass.toString();
                        s.hintOnur = `≈ûƒ∞FRE PAR√áA A: ${pass.toString().substring(0,3)}`;
                        s.hintOzlem = `≈ûƒ∞FRE PAR√áA B: ${pass.toString().substring(3,5)}`;
                        s.question = "KRƒ∞Tƒ∞K G√úVENLƒ∞K KODUNU Gƒ∞R"; s.input = "numpad";
                    } 
                    else if (level % 3 === 0) { // Dedektiflik
                        s.theme = "detective";
                        let items = ['SAAT', 'Y√úZ√úK', 'KOLYE'];
                        let item = pick(items); s.answer = item;
                        s.hintOnur = "Kayƒ±p e≈üya metalden yapƒ±lmƒ±≈ü.";
                        s.hintOzlem = (item==='SAAT')?"Zamanƒ± g√∂sterir.":(item==='Y√úZ√úK'?"Parmaƒüa takƒ±lƒ±r.":"Boyna takƒ±lƒ±r.");
                        s.question = "KAYIP E≈ûYA NEDƒ∞R?"; s.input = "custom_3"; s.options = items;
                    }
                    else if (level % 2 === 0) { // Askeri
                        s.theme = "military";
                        let dir = pick(['KUZEY','G√úNEY','DOƒûU','BATI']); s.answer = dir;
                        s.hintOnur = (activeRole==='onur')?"TALƒ∞MAT BEKLE":`HEDEF Y√ñN: ${dir}`;
                        s.hintOzlem = (activeRole==='ozlem')?"TALƒ∞MAT BEKLE":`HEDEF Y√ñN: ${dir}`;
                        s.question = "Bƒ∞RLƒ∞KLERƒ∞ Y√ñNLENDƒ∞R"; s.input = "arrows";
                    }
                    else { // Klasik
                        s.theme = "classic";
                        let n = rdm(1, 9); s.answer = n.toString();
                        s.hintOnur = `X = ${n+5}`; s.hintOzlem = `X - 5 = ?`;
                        s.question = "SONU√á NEDƒ∞R?"; s.input = "numpad";
                    }
                    break;
            }

            return { s: s, activeRole: activeRole };
        }

        // --- OYUN AKI≈ûI ---
        function selectRole(role) {
            myRole = role;
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('lobbyScreen').classList.remove('hidden');
            gameRef.child('players/' + role).set(true);
            
            if (role === 'onur') {
                gameRef.child('state').get().then(snap => {
                    if(!snap.exists()) updateGame(1);
                });
            }
            listen();
        }

        function updateGame(level) {
            const newData = generateScenario(level);
            gameRef.update({ level: level, data: newData });
        }

        function listen() {
            gameRef.child('players').on('value', snap => {
                const p = snap.val();
                if(p && p.onur && p.ozlem) {
                    document.getElementById('lobbyScreen').classList.add('hidden');
                    document.getElementById('gameScreen').classList.remove('hidden');
                } else {
                    document.getElementById('lobbyStatus').innerText = myRole==='onur'?"√ñZLEM BEKLENƒ∞YOR...":"ONUR BEKLENƒ∞YOR...";
                }
            });

            gameRef.on('value', snap => {
                const val = snap.val();
                if(!val || !val.data) return;

                // TEMA UYGULA
                document.body.className = `theme-${val.data.s.theme}`;
                
                document.getElementById('lvlNum').innerText = val.level;
                document.getElementById('missionTitle').innerText = val.data.s.title;
                
                if (val.level > 55) {
                    document.getElementById('gameScreen').classList.add('hidden');
                    document.getElementById('winScreen').classList.remove('hidden');
                } else {
                    renderGame(val.data);
                }
            });
        }

        // --- RENDER ---
        function renderGame(data) {
            currentData = data.s;
            isActive = (myRole === data.activeRole);
            const container = document.getElementById('gameScreen');
            container.innerHTML = "";

            const myHint = myRole === 'onur' ? data.s.hintOnur : data.s.hintOzlem;
            
            let html = `
                <div class="intel-box">
                    <div class="intel-label">ƒ∞STƒ∞HBARAT VERƒ∞Sƒ∞</div>
                    <div>${myHint}</div>
                </div>
                
                <div class="question-box">
                    ${data.s.question}
                </div>

                <div class="controls">
            `;

            if(isActive) {
                if(data.s.input === 'numpad') {
                    html += `<input id="inp" type="number" readonly>
                             <div class="grid-3">
                                ${[1,2,3,4,5,6,7,8,9].map(n=>`<button onclick="document.getElementById('inp').value+='${n}'">${n}</button>`).join('')}
                                <button onclick="document.getElementById('inp').value=''">C</button>
                                <button onclick="document.getElementById('inp').value+='0'">0</button>
                                <button onclick="check(document.getElementById('inp').value)" style="background:var(--text); color:var(--bg)">Gƒ∞R</button>
                             </div>`;
                }
                else if(data.s.input === 'suspects') {
                    html += `<div class="grid-2">
                                ${data.s.options.map(o => `<button onclick="check('${o}')">${o}</button>`).join('')}
                             </div>`;
                }
                else if(data.s.input === 'colors_2') {
                    html += `<div class="grid-2">
                                <button style="color:red; border-color:red" onclick="check('KIRMIZI')">KIRMIZI</button>
                                <button style="color:cyan; border-color:cyan" onclick="check('MAVƒ∞')">MAVƒ∞</button>
                             </div>`;
                }
                else if(data.s.input === 'left_right') {
                    html += `<div class="grid-2">
                                <button onclick="check('SOL')">‚¨ÖÔ∏è SOL</button>
                                <button onclick="check('SAƒû')">SAƒû ‚û°Ô∏è</button>
                             </div>`;
                }
                else if(data.s.input === 'text') {
                    html += `<input id="inp" type="text" style="text-transform:uppercase">
                             <button onclick="check(document.getElementById('inp').value)">G√ñNDER</button>`;
                }
                else if(data.s.input === 'arrows') {
                    html += `<div class="grid-2">
                                <button onclick="check('KUZEY')">‚¨ÜÔ∏è</button>
                                <button onclick="check('G√úNEY')">‚¨áÔ∏è</button>
                                <button onclick="check('BATI')">‚¨ÖÔ∏è</button>
                                <button onclick="check('DOƒûU')">‚û°Ô∏è</button>
                             </div>`;
                }
                else if(data.s.input === 'custom_3') {
                    html += `<div class="grid-3">
                                ${data.s.options.map(o => `<button onclick="check('${o}')">${o}</button>`).join('')}
                             </div>`;
                }
                html += `</div>`;
            } else {
                html += `<div style="text-align:center; opacity:0.5; margin-top:20px;">
                            <div style="font-size:2rem; animation:pulse 1s infinite">‚úã</div>
                            <p>PARTNER CEVAPLIYOR...</p>
                         </div>
                         <style>@keyframes pulse{0%{opacity:0.5}50%{opacity:1}100%{opacity:0.5}}</style>`;
            }

            container.innerHTML = html;
        }

        // --- KONTROL ---
        function check(val) {
            if(!val) return;
            if(val.toString().toUpperCase().trim() === currentData.answer.toString().toUpperCase().trim()) {
                gameRef.child('level').get().then(snap => updateGame((snap.val()||1)+1));
            } else {
                document.getElementById('failOverlay').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('failOverlay').classList.add('hidden');
                    updateGame(1);
                }, 3000);
            }
        }

        function resetGame() {
            gameRef.set({ level: 1, players: {onur:false, ozlem:false}, data: null });
            location.reload();
        }

    </script>
</body>
</html>