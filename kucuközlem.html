<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K√º√ß√ºk √ñzlem: B√ºy√ºk Soygun üí∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; font-family: 'Poppins', sans-serif; }
        
        body {
            background-color: #222;
            overflow: hidden;
            touch-action: none; /* Mobilde kaydƒ±rmayƒ± engelle */
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            /* Fare imlecini ni≈üangah yapalƒ±m */
            cursor: crosshair;
        }

        /* ARAY√úZ KATMANI */
        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%;
            padding: 20px;
            pointer-events: none;
            display: flex;
            justify-content: space-between;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .hud-box {
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid #ff9800;
        }

        .hud-label { font-size: 0.9rem; color: #ccc; }
        .hud-value { font-size: 1.5rem; font-weight: bold; color: #ff9800; }

        /* BA≈ûLANGI√á/Bƒ∞Tƒ∞≈û EKRANLARI */
        .screen {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 20, 0.95);
            padding: 30px;
            border-radius: 20px;
            border: 4px solid #ff9800;
            text-align: center;
            color: white;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 30px rgba(255, 152, 0, 0.3);
            pointer-events: auto;
        }

        .hidden { display: none !important; }

        h1 { color: #ff9800; margin-bottom: 15px; font-size: 1.8rem; }
        p { margin-bottom: 25px; opacity: 0.8; }

        .action-btn {
            background: linear-gradient(to bottom, #ff9800, #f57c00);
            border: none;
            padding: 15px 40px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px #c66900;
            transition: all 0.1s;
        }
        .action-btn:active { box-shadow: 0 2px #c66900; transform: translateY(3px); }

        .home-btn {
            position: absolute;
            bottom: 20px; right: 20px;
            text-decoration: none; color: rgba(255,255,255,0.6);
            background: rgba(0,0,0,0.5); padding: 10px 15px; border-radius: 30px;
            font-size: 0.9rem; pointer-events: auto;
        }

        /* Vurma Efekti Animasyonu */
        @keyframes hitPop {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        .hit-effect {
            position: absolute;
            font-size: 2rem;
            pointer-events: none;
            animation: hitPop 0.5s forwards;
            color: #00ff88;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div class="ui-layer">
        <div class="hud-box">
            <div class="hud-label">Kasa Puanƒ±</div>
            <div class="hud-value" id="scoreVal">0</div>
        </div>
        <div class="hud-box" style="border-color: #ff3b3b;">
            <div class="hud-label">Kalan S√ºre</div>
            <div class="hud-value" id="timeVal" style="color: #ff3b3b;">30</div>
        </div>
    </div>

    <div id="gameContainer"></div> <div id="startScreen" class="screen">
        <h1>K√º√ß√ºk √ñzlem: B√ºy√ºk Soygun üí∞</h1>
        <p>Oyuncak hapishanesine sƒ±zdƒ±n! G√ºvenlikleri (üëÆ‚Äç‚ôÇÔ∏è) uyku tabancanla vur ve kasayƒ± a√ß.</p>
        <p style="font-size:0.9rem; color:#ff9800;">Hedef: 30 Saniyede 15 Puan!</p>
        <button class="action-btn" onclick="startGame()">OPERASYONU BA≈ûLAT ‚ñ∂Ô∏è</button>
    </div>

    <div id="gameOverScreen" class="screen hidden">
        <h1 id="resultTitle">S√ºre Doldu!</h1>
        <p>Toplam Puanƒ±n: <span id="finalScore" style="font-weight:bold; color:#ff9800; font-size:1.5rem;">0</span></p>
        <p id="resultMsg">Kasa a√ßƒ±lamadƒ±...</p>
        <button class="action-btn" onclick="startGame()">TEKRAR DENE üîÑ</button>
        <br><br>
        <a href="index.html" style="color: #aaa; text-decoration: none;">Ana Sayfaya D√∂n</a>
    </div>
    
     <a href="index.html" class="home-btn">üè† √áƒ±kƒ±≈ü</a>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameContainer = document.getElementById('gameContainer');

        let isPlaying = false;
        let score = 0;
        let timeLeft = 30;
        let gameLoopId;
        let timerInterval;
        let spawnTimer = 0;

        // Oyun Ayarlarƒ±
        const WIN_SCORE = 15;
        const GAME_DURATION = 30; // saniye

        // Hedefler (Polisler)
        let targets = [];
        // Saklanma noktalarƒ± (Variller/Kutular)
        let hideSpots = [];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initHideSpots();
        }
        window.addEventListener('resize', resize);

        function initHideSpots() {
            // Ekranƒ±n alt kƒ±smƒ±na 3-4 tane saklanma noktasƒ± koyalƒ±m
            hideSpots = [];
            const spotCount = canvas.width > 600 ? 4 : 3;
            const margin = canvas.width / (spotCount + 1);
            
            for(let i=1; i<=spotCount; i++) {
                hideSpots.push({
                    x: margin * i,
                    y: canvas.height - 100, // Zeminden biraz yukarƒ±da
                    width: 80,
                    height: 100,
                    isOccupied: false
                });
            }
        }

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            
            score = 0;
            timeLeft = GAME_DURATION;
            targets = [];
            isPlaying = true;
            spawnTimer = 0;
            
            updateHUD();
            initHideSpots();
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateHUD();
                if(timeLeft <= 0) finishGame();
            }, 1000);

            cancelAnimationFrame(gameLoopId);
            gameLoop();
        }

        function finishGame() {
            isPlaying = false;
            clearInterval(timerInterval);
            cancelAnimationFrame(gameLoopId);
            
            document.getElementById('finalScore').innerText = score;
            const title = document.getElementById('resultTitle');
            const msg = document.getElementById('resultMsg');

            if(score >= WIN_SCORE) {
                title.innerText = "KASA A√áILDI! üí∞ü§©";
                title.style.color = "#00ff88";
                msg.innerText = "Tebrikler Ajan √ñzlem, oyuncaklarƒ± kurtardƒ±n!";
            } else {
                title.innerText = "BA≈ûARISIZ OLDU... üö®";
                title.style.color = "#ff3b3b";
                msg.innerText = `Kasayƒ± a√ßmak i√ßin ${WIN_SCORE} puan gerekiyordu.`;
            }

            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        function update() {
            spawnTimer++;

            // Yeni hedef olu≈ütur (Her 40-80 karede bir)
            if (spawnTimer > Math.random() * 40 + 40) {
                spawnTarget();
                spawnTimer = 0;
            }

            // Hedefleri g√ºncelle
            for (let i = targets.length - 1; i >= 0; i--) {
                let t = targets[i];
                
                if (t.state === 'rising') {
                    t.y -= t.speed;
                    if (t.y <= t.maxY) {
                        t.y = t.maxY;
                        t.state = 'waiting';
                        t.WaitTimer = 0;
                    }
                } else if (t.state === 'waiting') {
                    t.WaitTimer++;
                    // 60-120 kare bekle (1-2 saniye)
                    if (t.WaitTimer > Math.random() * 60 + 60) {
                        t.state = 'hiding';
                    }
                } else if (t.state === 'hiding') {
                    t.y += t.speed;
                    if (t.y >= t.startY) {
                        // Tamamen saklandƒ±
                        hideSpots[t.spotIndex].isOccupied = false;
                        targets.splice(i, 1);
                    }
                }
            }
        }

        function spawnTarget() {
            // Bo≈ü bir saklanma noktasƒ± bul
            const availableSpots = hideSpots.filter(s => !s.isOccupied);
            if (availableSpots.length === 0) return;

            const spot = availableSpots[Math.floor(Math.random() * availableSpots.length)];
            spot.isOccupied = true;

            targets.push({
                spotIndex: hideSpots.indexOf(spot),
                x: spot.x - 40, // Spotun ortasƒ±na hizala
                y: spot.y,      // Ba≈ülangƒ±√ß Y (saklƒ±)
                startY: spot.y,
                maxY: spot.y - 90, // Ne kadar yukarƒ± √ßƒ±kacak
                width: 80,
                height: 80,
                state: 'rising', // rising, waiting, hiding
                speed: 4,
                WaitTimer: 0,
                emoji: "üëÆ‚Äç‚ôÇÔ∏è"
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Arka Plan (Hapishane Duvarƒ±)
            ctx.fillStyle = "#333";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = "#444";
            ctx.lineWidth = 2;
            for(let i=0; i<canvas.height; i+=50) {
                ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke();
            }

            // Saklanma Noktalarƒ± (Variller/Kutular) - √ñN KATMAN
            for (let spot of hideSpots) {
                 // Arkasƒ±ndaki hedefler g√∂r√ºns√ºn diye √∂nce hedefleri √ßiziyoruz, sonra kutularƒ±.
            }

             // Hedefleri √áiz
             for (let t of targets) {
                ctx.font = "70px Arial";
                ctx.textAlign = "center";
                // Y koordinatƒ±nƒ± emoji tabanƒ±na g√∂re ayarla
                ctx.fillText(t.emoji, t.x + t.width/2, t.y + t.height);
            }

            // Saklanma Noktalarƒ±nƒ± √áiz (En √ñne)
            ctx.fillStyle = "#5D4037"; // Kutu rengi
            ctx.strokeStyle = "#3E2723";
            for (let spot of hideSpots) {
                ctx.fillRect(spot.x - 40, spot.y, 80, 100);
                ctx.strokeRect(spot.x - 40, spot.y, 80, 100);
                // Kutu detayƒ±
                ctx.fillStyle = "#4E342E";
                ctx.fillRect(spot.x - 30, spot.y + 20, 60, 5);
                ctx.fillStyle = "#5D4037";
            }
        }

        function gameLoop() {
            if (!isPlaying) return;
            update();
            draw();
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        function updateHUD() {
            document.getElementById('scoreVal').innerText = score;
            document.getElementById('timeVal').innerText = timeLeft;
        }

        // --- ATI≈û KONTROL√ú (MOBƒ∞L & PC) ---
        function shoot(e) {
            if (!isPlaying) return;
            
            // Mobilde dokunma, PC'de tƒ±klama koordinatlarƒ±nƒ± al
            let clientX, clientY;
            if(e.type === 'touchstart') {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            // Hedefleri kontrol et
            for (let i = targets.length - 1; i >= 0; i--) {
                let t = targets[i];
                // Sadece saklanmƒ±yorsa vurulabilir
                if (t.state !== 'hiding') {
                    // Basit dikd√∂rtgen √ßarpƒ±≈üma testi (Emoji alanƒ± i√ßin)
                    if(clientX >= t.x && clientX <= t.x + t.width &&
                       clientY >= t.y && clientY <= t.y + t.height + 20) { // +20 emoji boyu toleransƒ±
                        
                        // VURULDU!
                        score++;
                        updateHUD();
                        
                        // Vurma Efekti G√∂ster
                        showHitEffect(clientX, clientY);

                        // Hedefi kaldƒ±r ve spotu bo≈üalt
                        hideSpots[t.spotIndex].isOccupied = false;
                        targets.splice(i, 1);
                        
                        // Bir atƒ±≈üta sadece bir hedef vurulsun
                        break; 
                    }
                }
            }
        }

        function showHitEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'hit-effect';
            effect.innerText = "üí§ UYUDU!";
            effect.style.left = (x - 50) + 'px'; // Ortalama
            effect.style.top = (y - 30) + 'px';
            gameContainer.appendChild(effect);
            
            // Animasyon bitince DOM'dan sil
            setTimeout(() => {
                effect.remove();
            }, 500);
        }

        // Olay Dinleyicileri
        canvas.addEventListener('mousedown', shoot);
        canvas.addEventListener('touchstart', shoot, {passive: false});

        // Ba≈ülangƒ±√ß
        resize();
        initHideSpots();
        draw(); // ƒ∞lk ekranƒ± √ßiz

    </script>
</body>
</html>