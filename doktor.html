<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dr. Hedef 2026 ü©∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        /* MOBƒ∞L UYUMLU VE MODERN CSS */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }

        body {
            background: radial-gradient(circle at center, #2d0a55 0%, #0f051d 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px; 
            padding-bottom: 90px;
        }

        h1 {
            color: #e0aaff;
            text-shadow: 0 0 15px rgba(224, 170, 255, 0.6);
            margin-bottom: 5px;
            font-size: 1.5rem; /* Mobilde biraz k√º√ß√ºltt√ºm */
            text-align: center;
        }

        /* KART TASARIMI */
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 20px;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            border: 1px solid rgba(224, 170, 255, 0.15);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            margin-bottom: 15px;
        }

        /* YKS SAYA√á */
        .yks-area { text-align: center; padding: 15px; }
        .yks-days { font-size: 2rem; font-weight: 800; color: #00ff88; margin: 5px 0; }
        .yks-date { font-size: 0.75rem; opacity: 0.7; }

        /* ƒ∞STATƒ∞STƒ∞K KUTULARI (YAN YANA) */
        .stats-row {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 500px;
            margin-bottom: 15px;
        }

        .stat-box {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 15px 5px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* DAƒ∞RE GRAFƒ∞K */
        .circle-wrap { position: relative; width: 60px; height: 60px; margin-bottom: 5px; }
        .circle-wrap svg { width: 60px; height: 60px; transform: rotate(-90deg); }
        .circle-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 5; }
        .circle-progress { 
            fill: none; 
            stroke: #bc13fe; 
            stroke-width: 5; 
            stroke-dasharray: 150; /* √áevre */
            stroke-dashoffset: 150; 
            transition: stroke-dashoffset 1s ease;
            stroke-linecap: round;
        }
        .circle-text {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold; font-size: 0.7rem;
        }

        .stat-label { font-size: 0.7rem; color: #e0aaff; }
        .stat-val { font-size: 1.1rem; font-weight: bold; }
        .stat-desc { font-size: 0.6rem; color: #aaa; margin-top: 2px; line-height: 1.2; }

        /* HAFTALIK RAPOR Lƒ∞STESƒ∞ */
        .weekly-list { max-height: 180px; overflow-y: auto; }
        .week-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            margin-bottom: 8px;
            border-left: 4px solid #555;
        }
        .week-dates { font-size: 0.8rem; color: #ddd; }
        .week-total { font-size: 0.9rem; font-weight: bold; color: white; }

        /* Gƒ∞Rƒ∞≈û ALANI */
        .input-group { display: flex; gap: 8px; }
        
        input {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #7b2cbf;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 1rem;
            text-align: center;
            outline: none;
            width: 100%; /* Mobil ta≈üma √∂nlemi */
        }

        button.main-btn {
            padding: 12px 15px;
            background: linear-gradient(90deg, #bc13fe, #7b2cbf);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
        }

        /* G√úNL√úK Lƒ∞STE (MOBƒ∞L UYUMLU) */
        .history-list { max-height: 300px; overflow-y: auto; }
        
        .entry-item {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #555;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Mobilde sƒ±ƒümazsa a≈üaƒüƒ± kaysƒ±n */
            gap: 10px;
        }

        .entry-info { 
            display: flex; 
            flex-direction: column; 
            flex: 1; 
            min-width: 140px; 
        }
        
        .entry-date { font-size: 0.7rem; color: #aaa; }
        .entry-goal { font-size: 0.85rem; color: #fff; margin-top: 2px; }
        
        .action-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Mobil Ekran Ayarƒ± */
        @media (max-width: 450px) {
            .entry-item { flex-direction: column; align-items: flex-start; }
            .action-group { width: 100%; justify-content: flex-end; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px; }
        }

        .complete-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #00e5ff;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .delete-btn {
            background: rgba(255, 59, 59, 0.15);
            border: 1px solid #ff3b3b;
            color: #ff3b3b;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .status-badge { font-size: 0.6rem; padding: 2px 4px; border-radius: 4px; margin-left: 4px; font-weight: bold; vertical-align: middle; }
        .pending { background: #ff9800; color: black; }
        .success { background: #00ff88; color: black; }
        .fail { background: #ff3b3b; color: white; }

        #notification {
            position: fixed; top: 20px;
            background: #00ff88; color: #1a0b2e;
            padding: 10px 20px; border-radius: 50px;
            font-weight: bold; transform: translateY(-200%);
            transition: transform 0.5s; z-index: 999;
            font-size: 0.85rem;
            width: 80%; text-align: center; left: 10%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div id="notification">Harikasƒ±n! ü©∫</div>

    <h1>Dr. Hedef 2026</h1>
    <div style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 20px;" id="currentDateDisplay">...</div>

    <div class="card yks-area">
        <div>YKS 2026'ya Kalan</div>
        <div class="yks-days" id="countdown">...</div>
        <div class="yks-date">20 Haziran 2026 Cumartesi, 10.15</div>
    </div>

    <div class="stats-row">
        <div class="stat-box">
            <div class="circle-wrap">
                <svg><circle cx="30" cy="30" r="25" class="circle-bg"></circle><circle cx="30" cy="30" r="25" class="circle-progress" id="weekCircle"></circle></svg>
                <div class="circle-text" id="weekPercent">%0</div>
            </div>
            <div class="stat-label">Bu Hafta</div>
            <div class="stat-val"><span id="weekTotal">0</span> / 50s</div>
        </div>

        <div class="stat-box" style="border-color: #00e5ff;">
            <div style="font-size: 1.5rem; margin-bottom: 5px;">üèÜ</div>
            <div class="stat-label">Tamamlanan D√∂ng√ºler</div>
            <div class="stat-val" style="color: #00e5ff;"><span id="cycleTotal">0</span> Saat</div>
            <div class="stat-desc">4 hafta dolunca eklenir</div>
        </div>
    </div>

    <div class="card">
        <h3 style="margin-bottom:10px; font-size:0.95rem; color:#e0aaff;">üìä Haftalƒ±k Ge√ßmi≈ü (Son 1 Ay)</h3>
        <div class="weekly-list" id="weeklyReportList">
            </div>
    </div>

    <div class="card">
        <h3 style="margin-bottom:10px; color:#e0aaff; font-size:0.95rem;">üéØ Bug√ºn Ne Kadar √áalƒ±≈üacaksƒ±n?</h3>
        <div class="input-group">
            <input type="number" id="targetInput" placeholder="Saat Gir" step="0.5">
            <button class="main-btn" onclick="addGoal()">Ba≈ülat üöÄ</button>
        </div>
    </div>

    <div class="card">
        <h3 style="margin-bottom:10px; font-size:0.95rem; opacity:0.8;">√áalƒ±≈üma G√ºnl√ºƒü√º</h3>
        <div class="history-list" id="historyList"></div>
    </div>

    <a href="index.html" style="color:rgba(255,255,255,0.5); text-decoration:none; margin-top:10px; font-size:0.8rem;">üè† Ana Sayfaya D√∂n</a>

    <script>
        document.getElementById('currentDateDisplay').innerText = new Date().toLocaleDateString('tr-TR', { weekday: 'long', day: 'numeric', month: 'long' });

        const yksDate = new Date("2026-06-20T10:15:00").getTime();
        setInterval(() => {
            const now = new Date().getTime();
            const days = Math.floor((yksDate - now) / (1000 * 60 * 60 * 24));
            document.getElementById("countdown").innerText = days + " G√ºn";
        }, 1000);

        const WEEKLY_GOAL = 50;

        function loadData() {
            const records = JSON.parse(localStorage.getItem('docTracker')) || [];
            const list = document.getElementById('historyList');
            list.innerHTML = "";
            
            // Tarihe g√∂re sƒ±rala
            records.sort((a, b) => b.timestamp - a.timestamp);

            records.forEach(rec => {
                const item = document.createElement('div');
                let statusBadge = "";
                let borderStyle = "";
                let actionHTML = "";
                const deleteBtn = `<button class="delete-btn" onclick="deleteEntry(${rec.id})">üóëÔ∏è</button>`;

                if (rec.actual === null) {
                    borderStyle = "border-left-color: #ff9800;"; 
                    statusBadge = "<span class='status-badge pending'>S√ºr√ºyor</span>";
                    actionHTML = `<button class="complete-btn" onclick="completeDay(${rec.id})">Tamamla ‚úÖ</button>`;
                } else {
                    if (rec.actual >= rec.target) {
                        borderStyle = "border-left-color: #00ff88;";
                        statusBadge = "<span class='status-badge success'>Ba≈üarƒ±lƒ±</span>";
                        actionHTML = `<span style="font-size:1.2rem; margin-right:5px;">üîí</span>`;
                    } else {
                        borderStyle = "border-left-color: #ff3b3b;";
                        statusBadge = "<span class='status-badge fail'>Eksik</span>";
                        actionHTML = `<button class="complete-btn" onclick="completeDay(${rec.id})" style="border-color:#00e5ff; color:#00e5ff;">+ Ekle</button>`;
                    }
                }

                item.className = "entry-item";
                item.style = borderStyle;
                item.innerHTML = `
                    <div class="entry-info">
                        <div class="entry-date">${rec.dateString}</div>
                        <div class="entry-goal">
                            Hedef: <b>${rec.target}s</b> 
                            ${rec.actual !== null ? ` | Yapƒ±lan: <b>${rec.actual}s</b>` : ""}
                            ${statusBadge}
                        </div>
                    </div>
                    <div class="action-group">
                        ${actionHTML}
                        ${deleteBtn}
                    </div>
                `;
                list.appendChild(item);
            });
            
            calculateStats(records);
            renderWeeklyReport(records);
        }

        // --- HAFTALIK RAPOR (SON 4 HAFTA) ---
        function renderWeeklyReport(records) {
            const list = document.getElementById('weeklyReportList');
            list.innerHTML = "";
            const weeks = {};

            records.forEach(rec => {
                if (rec.actual !== null) {
                    const d = new Date(rec.timestamp);
                    const monday = getMonday(d);
                    
                    // Anahtar: YYYY-MM-DD (Yerel Saat ile)
                    const year = monday.getFullYear();
                    const month = String(monday.getMonth() + 1).padStart(2, '0');
                    const day = String(monday.getDate()).padStart(2, '0');
                    const key = `${year}-${month}-${day}`; 
                    
                    if (!weeks[key]) weeks[key] = 0;
                    weeks[key] += rec.actual;
                }
            });

            const sortedKeys = Object.keys(weeks).sort((a, b) => new Date(b) - new Date(a));
            const recentWeeks = sortedKeys.slice(0, 4); 

            recentWeeks.forEach(key => {
                const parts = key.split('-');
                const monday = new Date(parts[0], parts[1] - 1, parts[2]); // Yƒ±l, Ay(0-11), G√ºn
                
                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6); // Pazartesi + 6 g√ºn = Pazar

                const formatOpts = { day: 'numeric', month: 'short' };
                const rangeStr = `${monday.toLocaleDateString('tr-TR', formatOpts)} - ${sunday.toLocaleDateString('tr-TR', formatOpts)}`;
                
                const total = weeks[key];
                const borderClass = total >= WEEKLY_GOAL ? "border-left-color: #00ff88;" : "border-left-color: #ff9800;";

                const div = document.createElement('div');
                div.className = "week-item";
                div.style = borderClass;
                div.innerHTML = `
                    <div class="week-dates">${rangeStr}</div>
                    <div class="week-total">${total} Saat</div>
                `;
                list.appendChild(div);
            });

            if(sortedKeys.length === 0) {
                list.innerHTML = "<div style='text-align:center; font-size:0.8rem; opacity:0.5; padding:10px;'>Hen√ºz veri yok.</div>";
            }
        }

        // --- ƒ∞STATƒ∞STƒ∞K VE KUMBARA HESABI ---
        function calculateStats(records) {
            const now = new Date();
            const currentWeekStart = getMonday(new Date());
            
            let weekTotal = 0;
            let bankedTotal = 0; 

            // ƒ∞lk Kayƒ±t Tarihini Bul
            let firstRecordTime = now.getTime();
            if (records.length > 0) {
                const timestamps = records.map(r => r.timestamp);
                firstRecordTime = Math.min(...timestamps);
            }

            const msPer28Days = 28 * 24 * 60 * 60 * 1000;
            const timeSinceStart = now.getTime() - firstRecordTime;
            const currentCycleIndex = Math.floor(timeSinceStart / msPer28Days);

            records.forEach(rec => {
                if (rec.actual !== null) {
                    const recDate = new Date(rec.timestamp);

                    // A) BU HAFTA (Canlƒ± Veri) - Pazartesi Ba≈ülangƒ±√ßlƒ± Kontrol
                    if (recDate >= currentWeekStart) {
                        weekTotal += rec.actual;
                    }

                    // B) KUMBARA (Bitmi≈ü 4 Haftalƒ±k D√∂ng√ºler)
                    const diff = rec.timestamp - firstRecordTime;
                    const recCycleIndex = Math.floor(diff / msPer28Days);

                    if (recCycleIndex < currentCycleIndex) {
                        bankedTotal += rec.actual;
                    }
                }
            });

            // G√ñSTERƒ∞M: BU HAFTA
            const MAX_DASH = 150; // SVG stroke-dasharray
            let percentage = (weekTotal / WEEKLY_GOAL) * 100;
            if (percentage > 100) percentage = 100;
            
            document.getElementById('weekCircle').style.strokeDashoffset = MAX_DASH - (percentage / 100) * MAX_DASH;
            document.getElementById('weekPercent').innerText = `%${Math.round((weekTotal / WEEKLY_GOAL) * 100)}`;
            document.getElementById('weekTotal').innerText = weekTotal.toFixed(1);
            
            if(weekTotal >= WEEKLY_GOAL) {
                document.getElementById('weekCircle').style.stroke = "#00ff88"; 
                document.getElementById('weekPercent').style.color = "#00ff88";
            } else {
                document.getElementById('weekCircle').style.stroke = "#bc13fe";
                document.getElementById('weekPercent').style.color = "white";
            }

            // G√ñSTERƒ∞M: TAMAMLANAN D√ñNG√úLER
            document.getElementById('cycleTotal').innerText = bankedTotal.toFixed(1);
        }

        function addGoal() {
            const inp = document.getElementById('targetInput');
            const val = parseFloat(inp.value);
            if (!val || val <= 0) { alert("Ge√ßersiz hedef."); return; }

            const records = JSON.parse(localStorage.getItem('docTracker')) || [];
            const now = new Date();
            records.push({
                id: Date.now(),
                timestamp: now.getTime(),
                dateString: now.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short', hour:'2-digit', minute:'2-digit' }),
                target: val,
                actual: null
            });
            localStorage.setItem('docTracker', JSON.stringify(records));
            inp.value = "";
            showNotif("Hedef Ba≈ülatƒ±ldƒ±! üöÄ");
            loadData();
        }

        function completeDay(id) {
            const records = JSON.parse(localStorage.getItem('docTracker')) || [];
            const index = records.findIndex(r => r.id === id);
            if (index === -1) return;

            const currentActual = records[index].actual || 0;
            let msg = currentActual === 0 ? "Bug√ºn ka√ß saat √ßalƒ±≈ütƒ±n?" : `≈ûu an ${currentActual} saat kayƒ±tlƒ±. √úzerine ka√ß saat eklemek istersin?`;

            let hours = prompt(msg);
            if (hours === null) return;
            hours = parseFloat(hours);
            if (isNaN(hours) || hours < 0) { alert("Ge√ßersiz saat."); return; }

            records[index].actual = currentActual + hours;
            localStorage.setItem('docTracker', JSON.stringify(records));
            
            if (records[index].actual >= records[index].target) showNotif("TEBRƒ∞KLER! Kilitlendi üîí");
            else showNotif(`Toplam ${records[index].actual} saat oldu. Harika! üí™`);
            loadData();
        }

        function deleteEntry(id) {
            if(confirm("Silmek istiyor musun?")) {
                let records = JSON.parse(localStorage.getItem('docTracker')) || [];
                records = records.filter(r => r.id !== id);
                localStorage.setItem('docTracker', JSON.stringify(records));
                loadData();
            }
        }

        // --- PAZARTESƒ∞ HESAPLAMA (UTC SORUNU √á√ñZ√úLD√ú) ---
        function getMonday(d) {
            d = new Date(d);
            var day = d.getDay();
            // Pazar(0) ise, 6 g√ºn geri git. Diƒüer g√ºnler i√ßin (g√ºn - 1) kadar geri git.
            var diff = d.getDate() - day + (day == 0 ? -6 : 1); 
            
            // Yeni tarihi set et ve saati sƒ±fƒ±rla
            var newDate = new Date(d.setDate(diff));
            newDate.setHours(0,0,0,0);
            return newDate;
        }

        function showNotif(msg) {
            const n = document.getElementById('notification');
            n.innerText = msg; n.style.transform = "translateY(0)";
            setTimeout(() => n.style.transform = "translateY(-200%)", 3000);
        }

        loadData();
    </script>
</body>
</html>